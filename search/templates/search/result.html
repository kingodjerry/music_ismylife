<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{% static 'search/images/favicon.ico' %}" type="image/x-icon">
    <title>Ïò•ÌÉëÎ∞© ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏</title>
    <link rel="stylesheet" type="text/css" href="{% static 'search/css/result.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=music_note" />
</head>
<body>
    <!-- Ìó§Îçî -->
    <header>
        <h1>Ïò•ÌÉëÎ∞© ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏</h1>
        <span class="material-symbols-outlined">music_note</span>
    </header>

    <div class="main-container">
        <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
        <aside class="sidebar">
            <p class="sidebar-title">MENU</p>
            <hr>
            <button id="youtube-button" class="{% if platform == 'youtube' %}active{% endif %}">YouTube</button>
            <button id="spotify-button" class="{% if platform == 'spotify' %}active{% endif %}">Spotify</button>
        </aside>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Í≤ÄÏÉâÏ∞Ω -->
            <form action="{% url 'trigger_dag' %}" method="POST">
                {% csrf_token %}
                
                <!-- ÏóêÎü¨ Î©îÏãúÏßÄ Ï∂úÎ†• -->
                {% if errors %}
                    <div class="error-message">
                        {% for error in errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
        
                <div class="form-row">
                    <div class="checkbox-group">
                        <!-- YouTube Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                        <input type="radio" id="youtube" name="platform" value="youtube">
                        <label for="youtube" class="checkbox-label youtube">YouTube</label>
                        
                        <!-- Spotify Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                        <input type="radio" id="spotify" name="platform" value="spotify">
                        <label for="spotify" class="checkbox-label spotify">Spotify</label>
                    </div>                
                    <div class="group">
                        <svg class="icon" aria-hidden="true" viewBox="0 0 24 24">
                            <g>
                                <path d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z"></path>
                            </g>
                        </svg>
                        <input type="text" name="input_value" placeholder="ÎÖ∏Îûò Ï†úÎ™© ÌòπÏùÄ Í∞ÄÏàòÎ™ÖÏúºÎ°ú Í≤ÄÏÉâÌïòÏÑ∏Ïöî" class="input" required>
                    </div>
                </div>
            </form>

            <!-- Í≤ÄÏÉâÍ≤∞Í≥º -->
            <section class="result-container">
                <div class="head">
                    <h2>{{ input_value }}Í≥º ÎπÑÏä∑Ìïú Ïù¥Îü∞ ÎÖ∏ÎûòÎäî Ïñ¥ÎïåÏöî?</h2>
                </div>
                <!-- YouTube ÏΩòÌÖêÏ∏† -->
                <div id="youtube-section" class="{% if platform != 'youtube' %}hidden{% endif %}">
                    <!-- YouTube Ï∂îÏ≤ú ÎπÑÎîîÏò§ -->
                    <div class="youtube-videos-container">
                        <section class="result-list">
                            <h2 class="list_h2 youtube">Youtube Ï∂îÏ≤ú ÎπÑÎîîÏò§</h2>
                            <div class="results-grid">
                                {% for song in search_songs %}
                                    {% if song.platform == "youtube" %}
                                        <div class="result-item">
                                            <div class="thumbnail">
                                                <img src="{{ song.thumbnail }}" alt="{{ song.song_title }}">
                                            </div>
                                            <div class="details">
                                                <p class="title">{{ song.song_title }}</p>
                                            </div>
                                            <!-- Îã¥Í∏∞ Î≤ÑÌäº -->
                                            <div class="action">
                                                <a href="https://www.youtube.com/watch?v={{ song.song_url }}" class="view-btn" 
                                                target="_blank" data-title="{{ song.song_title }}" onclick="addToPlaylist('{{ song.song_title }}', '{{ song.song_url }}')">
                                                Îã¥Í∏∞
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% empty %}
                                <p>Ïú†ÌäúÎ∏å Ï∂îÏ≤ú ÎπÑÎîîÏò§Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                                {% endfor %}
                            </div>
                        </section>
                    </div>

                    <div class="youtube-playlist-container">
                        <section class="result-list">
                            <h2 class="list_h2 youtube">YouTube Ï∂îÏ≤ú ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏</h2>
                            <div class="results-grid">
                                {% for playlist in search_playlists %}
                                    {% if playlist.platform == "youtube" %}
                                        <div class="result-item">
                                            <div class="thumbnail">
                                                <img src="{{ playlist.thumbnail }}" alt="{{ playlist.playlist_title }}">
                                            </div>
                                            <div class="details">
                                                <p class="title">{{ playlist.playlist_title }}</p>
                                            </div>
                                            <div class="action">
                                                <a href="https://www.youtube.com/watch?v={{ playlist.playlist_url }}" 
                                                    class="view-btn" target="_blank" 
                                                    data-title="{{ playlist.playlist_title }}" 
                                                    onclick="addToPlaylist('{{ playlist.playlist_title }}', '{{ playlist.playlist_url }}')">
                                                    Îã¥Í∏∞
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% empty %}
                                <p>Ïú†ÌäúÎ∏å Ï∂îÏ≤ú ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                                {% endfor %}
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Spotify ÏΩòÌÖêÏ∏† -->
                <div id="spotify-section" class="{% if platform != 'spotify' %}hidden{% endif %}">
                    <!-- Spotify Ï∂îÏ≤ú ÎÖ∏Îûò -->
                    <div class="spotify-recommend-container">
                        <section class="result-list">
                            <h2 class="list_h2 spotify">Spotify Ï∂îÏ≤ú Í≥°</h2>
                            <div class="results-grid">
                                {% for song in search_songs %}
                                    {% if song.platform == "spotify" %}
                                        <div class="result-item">
                                            <iframe 
                                                src="{{ song.transformed_url }}" 
                                                width="250" 
                                                height="355" 
                                                frameborder="0" 
                                                allowtransparency="true" 
                                                allow="encrypted-media">
                                            </iframe>
                                        </div>
                                    {% endif %}
                                {% empty %}
                                <p>Ïä§Ìè¨Ìã∞ÌååÏù¥ Ï∂îÏ≤ú Í≥°Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
                                {% endfor %}
                            </div>
                        </section>
                    </div>

                    <!-- Spotify Ï∂îÏ≤ú ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏ -->
                    <div class="spotify-playlist-container">
                        <section class="result-list">
                            <h2 class="list_h2 spotify">Spotify Ï∂îÏ≤ú ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏</h2>
                            <div class="playlist-grid">
                                {% for playlist in search_playlists %}
                                    {% if playlist.platform == "spotify" %}
                                        <div class="spotify-playlist-item">
                                            <iframe 
                                                src="{{ playlist.playlist_url }}" 
                                                width="300" 
                                                height="380" 
                                                frameborder="0" 
                                                allowtransparency="true" 
                                                allow="encrypted-media">
                                            </iframe>
                                        </div>
                                    {% endif %}
                                {% empty %}
                                <p>Ïä§Ìè¨Ìã∞ÌååÏù¥ Ï∂îÏ≤ú ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                                {% endfor %}
                            </div>
                        </section>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Î™®Îã¨ -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <span class="close-btn" id="close-modal-btn">&times;</span>
            <h2 class="modal_h2">üéµ ÎÖ∏Îûò Ïû¨ÏÉù üéµ</h2>
            <div class="video-player">
                <iframe id="youtube-player" src="https://www.youtube.com/embed/{{ video_id }}?autoplay=1" frameborder="0" allowfullscreen></iframe>
            </div>
            <div class="video-controls">
                <button id="prev-btn">‚èÆÔ∏è</button>
                <button id="next-btn">‚è≠Ô∏è</button>
            </div>
            <ul class="video-list" id="video-list">
                <!-- YouTube ÎÖ∏Îûò Ï†úÎ™© Î¶¨Ïä§Ìä∏ -->
                {% for song in playlist %}
                    <li class="song-item">
                        {{ song.title }} <!-- ÎÖ∏Îûò Ï†úÎ™© ÌëúÏãú -->
                    </li>
                {% empty %}
                    <p>ÌîåÎ†àÏù¥Î¶¨Ïä§Ìä∏Ïóê ÎÖ∏ÎûòÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
                {% endfor %}
            </ul>            
        </div>
    </div>

    <!-- Toast Î©îÏãúÏßÄ -->
    <div id="toast" class="toast"></div>

    <!-- ÌîåÎ°úÌåÖ Î≤ÑÌäº -->
    <div class="floating-button" id="open-modal-btn">‚ñ∂</div>

    <!-- JavaScript -->
    <script src="{% static 'search/js/result.js' %}"></script>
</body>
</html>